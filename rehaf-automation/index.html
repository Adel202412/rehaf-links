<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>REHAF ‚Äî AI Virtual Office</title>
    <meta name="theme-color" content="#00ab9a" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=Tajawal:wght@500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
   
</head>

<body>

    <header class="header">
        <div class="container bar">
            <a class="brand" href="#">
                <!-- <div class="logoMark"></div><span>REHAF</span> -->
                <img class="logoMark" src="assets/pavicorn.png" alt="REHAF logo">
                <span>REHAF</span>

            </a>
            <a class="cta" href="mailto:info@rehaf.ae">Contact</a>
        </div>
    </header>

    <!-- HERO (hero module will render here) -->
    <section id="hero" class="hero"></section>

    <!-- OFFICE (shell required for office module) -->
    <section id="office" class="section container">
        <h2>REHAF Office</h2><br>
        <div class="sub">‚ÄúWant to know what I‚Äôm doing and what I‚Äôm capable of? Move across the floorplan and click a mascot ‚Äî I‚Äôll show you.‚Äù</div>
        <div class="officeWrap" id="officeWrap">
            <img id="floorplan" src="assets/floorplan.webp" alt="REHAF office floor plan" loading="eager" />
            <div class="pop" id="pop"></div>
        </div>
        <div id="servicePanel" aria-live="polite"></div>
        <!-- Optional quick summary grid; used by office module if present -->
        <div class="qgrid" id="quickGrid"></div>
    </section>

    <!-- WHY -->
    <section class="why">
        <h2>Why Automation Matters</h2>
        <p>Automation reduces repetitive work, lowers costs, and minimizes errors. With REHAF‚Äôs AI-driven systems, your team can focus on growth instead of routine tasks.</p>
    </section>

    <!-- TESTIMONY -->
    <section class="testimony">
        <h3>What People Say</h3>
        <p>‚ÄúREHAF helped us streamline operations and save countless hours. The virtual office is a game-changer.‚Äù</p>
    </section>

    <!-- CTA -->
    <section class="ctaBlock container">
        <h2 style="color:var(--accent);text-align:center">Let‚Äôs start your journey with us</h2>
        <p style="text-align:center;color:#475569;margin-top:6px">Tell us your goal. We‚Äôll automate the path.</p>
        <div style="display:flex;justify-content:center;margin-top:12px">
            <a class="btn primary" href="mailto:info@rehaf.ae">Contact Us</a>
        </div>
    </section>

    <!-- RUNNER (shell required for runner module) -->
    <section id="runner" class="section runner-wrap">
        <div class="runner-card" id="runnerCard">
            <div class="runner-head">
                <div>üéÆ <b>REHAF Runner</b> ‚Äî Tap or press <b>Space/‚Üë/W</b> (double jump)</div>
                <div>Score: <span id="runnerScore">0</span></div>
            </div>
            <canvas id="rehafRunner" width="820" height="240" aria-label="REHAF Runner game"></canvas>
            <div class="runner-help">Obstacles are E, H, A, F ‚Äî slower, smoother physics.</div>
        </div>
    </section>

    <!-- ARCHITECTURE (module will render into .container) -->
    <section id="architecture" class="arch">
        <div class="container"></div>
    </section>

    <!-- FOOTER (module will render into .container) -->
    <section id="footer" class="arabic">
        <div class="container"></div>
    </section>

    <!-- Boot loader (ES module) -->
    <script type="module" src="./rehaf-boot.js"></script>

    <!-- Minimal on-page debugger -->
    <script>
        (function() {
            const el = document.createElement('div');
            el.id = 'dbg';
            el.innerHTML = '<b>REHAF v2 debugger</b><div id="dbgmsg">Loading‚Ä¶</div>';
            document.body.appendChild(el);
            const msg = (t) => {
                document.getElementById('dbgmsg').textContent = t
            };

            function qs(s) {
                return document.querySelector(s)
            }
            const checks = [
                ['Modules boot tag', !!document.querySelector('script[type="module"][src="./rehaf-boot.js"]')],
                ['Hero container', !!qs('#hero')],
                ['Office wrap', !!qs('#officeWrap')],
                ['Office pop', !!qs('#pop')],
                ['Runner canvas', !!qs('#rehafRunner')],
                ['Runner score', !!qs('#runnerScore')],
                ['Runner card', !!qs('#runnerCard')],
                ['Architecture container', !!qs('#architecture .container')],
                ['Footer container', !!qs('#footer .container')],
            ];

            const bad = checks.filter(([_, ok]) => !ok);
            if (bad.length) {
                msg('Missing: ' + bad.map(b => b[0]).join(', '));
            } else {
                msg('Shells OK. Waiting for modules‚Ä¶');
            }

            // Network sanity for modules & JSON
            const toCheck = ['rehaf-boot.js', 'rehaf-hero.js', 'rehaf-office.js', 'rehaf-runner.js', 'rehaf-architecture.js', 'rehaf-footer.js', 'services.json'];
            toCheck.forEach(u => {
                fetch(u, {
                    method: 'HEAD'
                }).then(r => {
                    if (!r.ok) console.warn('[DBG] Missing/blocked:', u, r.status);
                }).catch(e => console.warn('[DBG] Network error:', u, e.message));
            });

            window.addEventListener('error', e => {
                msg('JS Error: ' + (e.message || 'see console'));
            });
            window.addEventListener('unhandledrejection', e => {
                msg('Promise rejection: ' + (e.reason || 'see console'));
            });
        })();
    </script>

    <script>
        (function() {
            function fixScale() {
                const vv = window.visualViewport ? window.visualViewport.width : window.innerWidth;
                const lw = document.documentElement.clientWidth;
                const ratio = vv / lw;
                const root = document.documentElement;

                // reset
                root.style.transform = "";
                root.style.transformOrigin = "";

                // if page looks "mini" (desktop-site mode), gently scale up
                if (ratio < 0.8) {
                    const scale = 1 / ratio;
                    root.style.transform = `scale(${scale})`;
                    root.style.transformOrigin = "top left";
                }
            }

            window.addEventListener("resize", fixScale);
            window.addEventListener("orientationchange", fixScale);
            fixScale();
        })();
    </script>
    <script>
        (function() {
            // Cache services once; read from top-level "departments"
            let servicesData = null;
            async function getServices() {
                if (servicesData) return servicesData;
                const r = await fetch('services.json');
                const raw = await r.json();
                servicesData = Array.isArray(raw) ? raw : (raw.departments || []);
                return servicesData;
            }

            // Helpers: get "sales.webp" from a src, and find matching department by img path (case-insensitive)
            function imgBase(src) {
                return (src || '').split('/').pop().toLowerCase(); // e.g., "sales.webp"
            }

            function findByImgBase(list, base) {
                return list.find(d => {
                    const p = (d.img || '').toLowerCase();
                    return p.endsWith('/' + base) || p.endsWith(base);
                });
            }

            // Render the accordion panel
            function renderPanel(item) {
                const wrap = document.getElementById('servicePanel');
                if (!wrap) return;

                const chips = (item.services || []).map(s => `<div class="acc-chip">${s}</div>`).join('');
                const tagline = item.tagline ? `<div class="acc-chip" style="font-weight:600">${item.tagline}</div>` : '';

                wrap.innerHTML = `
      <div class="accordion hide">
        <div class="acc-head">${item.title || 'Services'}</div>
        <div class="acc-body">
          ${tagline}
          ${chips || '<div class="acc-chip">No services listed</div>'}
        </div>
      </div>
    `;

                // small reveal
                requestAnimationFrame(() => {
                    const acc = wrap.querySelector('.accordion');
                    if (acc) acc.classList.remove('hide');
                });
            }

            function scrollServicesBodyIntoView() {
                const panel = document.getElementById('servicePanel');
                const acc = panel?.querySelector('.accordion');
                const body = panel?.querySelector('.acc-body');
                if (!panel || !acc || !body) return;

                // Sticky header allowance
                const header = document.querySelector('.header');
                const headerH = header ? header.getBoundingClientRect().height : 0;

                const bodyRect = body.getBoundingClientRect();
                const pad = 8; // small comfort padding

                // Visible viewport band (excluding sticky header)
                const vpTop = 0 + headerH + pad;
                const vpBottom = window.innerHeight - pad;

                let delta = 0;
                if (bodyRect.top < vpTop) {
                    // Body top is hidden above view ‚Üí scroll up just enough
                    delta = bodyRect.top - vpTop;
                } else if (bodyRect.bottom > vpBottom) {
                    // Body bottom is cut off ‚Üí scroll down just enough
                    delta = bodyRect.bottom - vpBottom;
                }

                if (delta !== 0) {
                    window.scrollBy({
                        top: delta,
                        left: 0,
                        behavior: 'smooth'
                    });
                }
            }
            // Attach click handlers once hotspots exist
            function attach() {
                const spots = document.querySelectorAll('.hotspot');
                if (!spots.length) {
                    setTimeout(attach, 300);
                    return;
                }

                spots.forEach(spot => {
                    spot.addEventListener('click', async (e) => {
                        e.preventDefault();
                        const img = spot.querySelector('img');
                        const base = imgBase(img?.getAttribute('src') || '');
                        const list = await getServices();

                        // 1) match by image filename
                        let item = findByImgBase(list, base);

                        // 2) fallback: match by visible label text or key
                        if (!item) {
                            const lbl = spot.querySelector('.lbl')?.textContent?.trim()?.toLowerCase();
                            item = list.find(d => (d.title || '').toLowerCase() === lbl) ||
                                list.find(d => (d.key || '').toLowerCase() === lbl);
                        }

                        if (!item) item = {
                            title: 'Services',
                            services: ['Details coming soon.']
                        };
                        renderPanel(item);

                        // After rendering, scroll only as needed to reveal services
                        requestAnimationFrame(() => {
                            // wait one more frame to ensure layout is settled
                            requestAnimationFrame(scrollServicesBodyIntoView);
                        });

                    }, {
                        passive: true
                    });
                });
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', attach);
            } else {
                attach();
            }
        })();
    </script>
</body>

</html>
